using Test

using Oiler

rtol = 0.001

function test_okada_ml_inputs_all_disps()
    fault = Dict(
        "strike" => 6.283185307179583,
        "delta" => 0.785398163397448,
        "L" => 78.617206771008568,
        "W" => 26.870057685088810,
        "lsd" => 20.,
        "ofx" => -9.850338894354840e+03,
        "ofy" => -20.000000000001140,
        "ofxe"=> -9.771721687583831e+03,
        "ofye" => -20.000000000001464,
        "tfx" => -9.850338894354840e+03,
        "tfy" => -1.000000000001139,
        "tfxe" => -9.771721687583831e+03,
        "tfye" => -1.000000000001459
    )

    xs = 1.0e4 .* [-1.000758826921680; -0.981095071914695; -0.981110799198045]
    ys = [0.044903674262838; 0.075810489054318; -0.081423421703794]

    ves, vns, vus, ved, vnd, vud, vet, vnt, vut = Oiler.okada(fault, 1., 1., 1.,
        xs, ys)

    @test isapprox(ves,    
        [0.000278311207785; -0.019970149820352; 0.003279330179775]; rtol=rtol)
    @test isapprox(vns,    
        [0.002821784569174; -0.000074894257506; 0.000072978696014]; rtol=rtol)
    @test isapprox(vus,    
        1.0e-3 .* [-0.316155394920109; 0.038678751237683; -0.037786443714757]; rtol=rtol)
    @test isapprox(ved,    
        1.0e-03 .* [-0.243919705202018; 0.035030039954510;-0.034934183707360]; rtol=rtol)
    @test isapprox(vnd,    
        [-0.000199992219480; -0.009262479825412; 0.024227041358989]; rtol=rtol)
    @test isapprox(vud,    
        [-0.001992787293162; 0.023204884580011; 0.057062430886315]; rtol=rtol)
    @test isapprox(vet,    
        1.0e-03 .* [0.244273925530614; -0.035436156199882; 0.034506189911012]; rtol=rtol)
    @test isapprox(vnt,    
        [0.000199966556297; -0.006285547974839; -0.006095019820654]; rtol=rtol)
    @test isapprox(vut,    
        [0.001992761716366; -0.038169618939615; -0.038100199139836]; rtol=rtol)

end

@testset "okada.jl unit tests" begin
    test_okada_ml_inputs_all_disps()
end